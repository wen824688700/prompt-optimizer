# 工作台修复测试指南

## 前置条件

1. 后端服务运行中：
```bash
cd backend
python -m uvicorn app.main:app --reload
```

2. 前端服务运行中：
```bash
cd frontend
npm run dev
```

## 测试步骤

### 测试 1：修改按钮功能

1. 访问 http://localhost:3000
2. 输入测试提示词：`帮我写一个关于产品营销的提示词，目标是提高转化率`
3. 点击"开始优化"
4. 选择推荐的框架（例如：AIDA Framework）
5. 填写追问问题：
   - 目标清晰度：提高产品转化率
   - 目标受众：25-35岁的年轻专业人士
   - 上下文完整性：电商平台的产品页面
   - 格式要求：简洁明了，突出卖点
   - 约束条件：字数控制在200字以内
6. 点击"生成"
7. 等待跳转到工作台页面
8. 在右侧点击"修改"按钮
9. **验证**：左侧编辑区应该显示优化后的内容
10. **验证**：应该显示提示信息："已将优化后的 Prompt 放入左侧..."

**预期结果**：
- ✅ 左侧编辑区内容更新为优化后的提示词
- ✅ 显示蓝色提示条
- ✅ 提示条5秒后自动消失

---

### 测试 2：重新生成功能

1. 继续上一个测试的工作台页面
2. 在左侧编辑区的末尾添加修改要求：
   ```
   
   请在上述内容基础上，增加以下要求：
   - 添加紧迫感元素
   - 强调限时优惠
   ```
3. 点击"重新生成"按钮
4. **验证**：按钮显示加载状态（"生成中..."）
5. 等待生成完成
6. **验证**：右侧显示新的优化内容
7. **验证**：版本记录标签页增加了新版本
8. 切换到"版本记录"标签
9. **验证**：看到两个版本（第一次生成 + 重新生成）

**预期结果**：
- ✅ 重新生成按钮显示加载状态
- ✅ 成功生成新内容
- ✅ 新内容包含了修改要求
- ✅ 版本列表增加了新版本
- ✅ 新版本类型为"优化"

---

### 测试 3：错误处理

#### 3.1 测试缺少框架信息

1. 打开浏览器开发者工具（F12）
2. 在 Console 中执行：
   ```javascript
   localStorage.removeItem('selectedFramework');
   localStorage.removeItem('clarificationAnswers');
   ```
3. 在工作台页面点击"重新生成"
4. **验证**：显示错误提示："缺少必要的信息，请返回首页重新开始"

**预期结果**：
- ✅ 显示错误提示
- ✅ 不会发送 API 请求

#### 3.2 测试 API 错误

1. 停止后端服务
2. 在工作台页面点击"重新生成"
3. **验证**：显示错误提示："重新生成失败: ..."

**预期结果**：
- ✅ 显示网络错误提示
- ✅ 加载状态正确结束

---

### 测试 4：完整流程测试

1. 清除浏览器缓存和 localStorage
2. 从首页开始完整流程：
   - 输入提示词
   - 匹配框架
   - 回答追问问题
   - 生成优化提示词
3. 在工作台：
   - 点击"修改"按钮
   - 编辑内容
   - 重新生成
   - 查看版本历史
   - 点击某个历史版本查看
   - 点击"回滚"按钮

**预期结果**：
- ✅ 所有功能正常工作
- ✅ 数据正确保存和读取
- ✅ 版本管理功能正常

---

## 常见问题排查

### 问题：点击"修改"后编辑区没有更新

**检查**：
1. 打开浏览器开发者工具
2. 查看 Console 是否有错误
3. 检查 `EditorPanel` 组件是否正确接收 `initialContent` prop
4. 检查 `useEffect` 是否正确触发

**解决方案**：
- 确保 `EditorPanel.tsx` 包含了监听 `initialContent` 变化的 `useEffect`

### 问题：重新生成失败

**检查**：
1. 后端服务是否运行
2. localStorage 中是否有 `selectedFramework` 和 `clarificationAnswers`
3. 查看 Network 标签中的 API 请求
4. 查看后端日志

**解决方案**：
- 确保从首页完整流程开始
- 确保后端服务正常运行
- 检查 API URL 配置

### 问题：版本列表没有更新

**检查**：
1. API 响应是否包含 `version_id`
2. `setVersions` 是否正确调用
3. 查看 React DevTools 中的状态

**解决方案**：
- 确保 API 返回正确的数据格式
- 检查版本对象的结构

---

## 测试报告模板

```
测试日期：____________________
测试人员：____________________

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 修改按钮功能 | ☐ 通过 ☐ 失败 | |
| 重新生成功能 | ☐ 通过 ☐ 失败 | |
| 错误处理 | ☐ 通过 ☐ 失败 | |
| 完整流程 | ☐ 通过 ☐ 失败 | |

问题记录：
1. 
2. 
3. 
```
